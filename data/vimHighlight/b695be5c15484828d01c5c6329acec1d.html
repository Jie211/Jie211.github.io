<font face="monospace"><font color="#5f875f">#!/bin/bash</font>
/sbin/modprobe nvidia
<font color="#87afd7">if&#xA0;</font><font color="#d7d787">[</font>&#xA0;<font color="#d7d787">&quot;</font><font color="#afaf5f">$?</font><font color="#d7d787">&quot;</font>&#xA0;<font color="#87afd7">-eq</font>&#xA0;<font color="#ffd787">0</font>&#xA0;<font color="#d7d787">]</font><font color="#d7d787">;</font>&#xA0;<font color="#87afd7">then</font>
&#xA0;&#xA0;<font color="#5f875f"># Count the number of NVIDIA controllers found.</font>
&#xA0;&#xA0;<font color="#ffafaf">NVDEVS</font>=<font color="#ffaf87">`lspci&#xA0;</font><font color="#d7d787">|</font><font color="#ffaf87">&#xA0;</font><font color="#87af87">grep</font><font color="#ffaf87">&#xA0;</font><font color="#ffaf87">-i</font><font color="#ffaf87">&#xA0;NVIDIA`</font>
&#xA0;&#xA0;<font color="#ffafaf">N3D</font>=<font color="#ffaf87">`</font><font color="#87af87">echo</font><font color="#87afaf">&#xA0;</font><font color="#d7d787">&quot;</font><font color="#afaf5f">$NVDEVS</font><font color="#d7d787">&quot;</font><font color="#87afaf">&#xA0;</font><font color="#d7d787">|</font><font color="#ffaf87">&#xA0;</font><font color="#87af87">grep</font><font color="#ffaf87">&#xA0;</font><font color="#d7d787">&quot;</font><font color="#87afaf">3D controller</font><font color="#d7d787">&quot;</font><font color="#ffaf87">&#xA0;</font><font color="#d7d787">|</font><font color="#ffaf87">&#xA0;wc&#xA0;</font><font color="#ffaf87">-l</font><font color="#ffaf87">`</font>
&#xA0;&#xA0;<font color="#ffafaf">NVGA</font>=<font color="#ffaf87">`</font><font color="#87af87">echo</font><font color="#87afaf">&#xA0;</font><font color="#d7d787">&quot;</font><font color="#afaf5f">$NVDEVS</font><font color="#d7d787">&quot;</font><font color="#87afaf">&#xA0;</font><font color="#d7d787">|</font><font color="#ffaf87">&#xA0;</font><font color="#87af87">grep</font><font color="#ffaf87">&#xA0;</font><font color="#d7d787">&quot;</font><font color="#87afaf">VGA compatible controller</font><font color="#d7d787">&quot;</font><font color="#ffaf87">&#xA0;</font><font color="#d7d787">|</font><font color="#ffaf87">&#xA0;wc&#xA0;</font><font color="#ffaf87">-l</font><font color="#ffaf87">`</font>
&#xA0;&#xA0;<font color="#ffafaf">N</font>=<font color="#ffaf87">`</font><font color="#87af87">expr</font><font color="#ffaf87">&#xA0;</font><font color="#afaf5f">$N3D</font><font color="#ffaf87">&#xA0;+&#xA0;</font><font color="#afaf5f">$NVGA</font><font color="#ffaf87">&#xA0;-&#xA0;</font><font color="#ffd787">1</font><font color="#ffaf87">`</font>
&#xA0;&#xA0;<font color="#87af87">for</font>&#xA0;i&#xA0;<font color="#87af87">in</font>&#xA0;<font color="#ffaf87">`seq&#xA0;</font><font color="#ffd787">0</font><font color="#ffaf87">&#xA0;</font><font color="#afaf5f">$N</font><font color="#ffaf87">`</font><font color="#d7d787">;</font>&#xA0;<font color="#87afd7">do</font>
&#xA0;&#xA0;<font color="#4e4e4e">&#xA6;</font>&#xA0;mknod&#xA0;<font color="#87afd7">-m</font>&#xA0;<font color="#ffd787">666</font>&#xA0;/dev/nvidia<font color="#afaf5f">$i</font>&#xA0;c&#xA0;<font color="#ffd787">195</font>&#xA0;<font color="#afaf5f">$i</font>
&#xA0;&#xA0;<font color="#87afd7">done</font>
&#xA0;&#xA0;mknod&#xA0;<font color="#87afd7">-m</font>&#xA0;<font color="#ffd787">666</font>&#xA0;/dev/nvidiactl c&#xA0;<font color="#ffd787">195</font>&#xA0;<font color="#ffd787">255</font>
<font color="#87afd7">else</font>&#xA0;fiexit&#xA0;<font color="#ffd787">1</font>
/sbin/modprobe nvidia-uvm
<font color="#87afd7">if&#xA0;</font><font color="#d7d787">[</font>&#xA0;<font color="#d7d787">&quot;</font><font color="#afaf5f">$?</font><font color="#d7d787">&quot;</font>&#xA0;<font color="#87afd7">-eq</font>&#xA0;<font color="#ffd787">0</font>&#xA0;<font color="#d7d787">]</font><font color="#d7d787">;</font>&#xA0;<font color="#87afd7">then</font>
&#xA0;&#xA0;<font color="#5f875f"># Find out the major device number used by the nvidia-uvm driver</font>
&#xA0;&#xA0;<font color="#ffafaf">D</font>=<font color="#ffaf87">`</font><font color="#87af87">grep</font><font color="#ffaf87">&#xA0;nvidia-uvm /proc/devices&#xA0;</font><font color="#d7d787">|</font><font color="#ffaf87">&#xA0;awk&#xA0;</font><font color="#d7d787">&apos;</font><font color="#87afaf">{print $1}</font><font color="#d7d787">&apos;</font><font color="#ffaf87">`</font>
&#xA0;&#xA0;mknod&#xA0;<font color="#87afd7">-m</font>&#xA0;<font color="#ffd787">666</font>&#xA0;/dev/nvidia-uvm c&#xA0;<font color="#afaf5f">$D</font>&#xA0;<font color="#ffd787">0</font>
<font color="#87afd7">else</font>
<font color="#87afd7">fi</font>
</font>